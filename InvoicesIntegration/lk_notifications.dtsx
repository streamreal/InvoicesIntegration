<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="3/4/2020 10:15:32 AM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="ETP025"
  DTS:CreatorName="ELTRANSPLUS\andreydruzhinin"
  DTS:DTSID="{F5456DB6-5EE4-4CC3-B486-0FA60E302DE0}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.2000.71"
  DTS:LocaleID="1049"
  DTS:ObjectName="Package1"
  DTS:PackageType="5"
  DTS:VersionBuild="6"
  DTS:VersionGUID="{01F5D11C-F933-44EC-A56A-BB197AE94C58}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:ConnectionManagers>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[SMTP Connection Manager]"
      DTS:CreationName="SMTP"
      DTS:DTSID="{C8786A8B-6D2E-4D7A-ABA7-5DD8F4DEAE84}"
      DTS:ObjectName="SMTP Connection Manager">
      <DTS:ObjectData>
        <SmtpConnectionManager
          ConnectionString="SmtpServer=10.10.0.50;UseWindowsAuthentication=False;EnableSsl=False;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
  </DTS:ConnectionManagers>
  <DTS:Variables>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{D7D9F392-E27C-4712-AFD0-BE95E0F2491F}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="id">
      <DTS:VariableValue
        DTS:DataType="3">0</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{B8642885-E304-4CC7-AAFA-52FC9A925596}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="msgtext">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{883EE317-3DAF-4AB4-9858-3D06035A36D0}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="object">
      <DTS:VariableValue
        DTS:DataSubType="ManagedSerializable"
        DTS:DataType="13">
        <SOAP-ENV:Envelope xmlns:clr="http://schemas.microsoft.com/soap/encoding/clr/1.0" xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">
          <SOAP-ENV:Body>
            <xsd:anyType
              id="ref-1"></xsd:anyType>
          </SOAP-ENV:Body>
        </SOAP-ENV:Envelope>
      </DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{9C3D2E10-67F7-416B-B1EF-57E108DE3007}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="subject">
      <DTS:VariableValue
        DTS:DataType="8">Уведомление о подключении рассылки Елтранс+</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{81056833-3773-4CBB-902D-607E64DC6C85}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="toline">
      <DTS:VariableValue
        DTS:DataType="8"
        xml:space="preserve"></DTS:VariableValue>
    </DTS:Variable>
  </DTS:Variables>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Merge"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{AB760523-D5F4-4BF8-A7FA-1A51289CBE62}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Merge"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{9FEB3277-5F6F-47B9-86DD-F48ABBDA0231}"
          SQLTask:SqlStatementSource="MERGE [webproject].[dbo].[notices_lk_settings] AS targ&#xA;USING (SELECT [Username]&#xA;      ,[terminal_arrival_flag]&#xA;      ,[tcd_reception_flag]&#xA;      ,[transit_closure_flag]&#xA;      ,[dt_submit_flag]&#xA;      ,[dt_registration_flag]&#xA;      ,[customs_examination_flag]&#xA;      ,[ptd_arrival_notice_flag]&#xA;      ,[dt_decision_flag]&#xA;      ,[terminal_departure_flag]&#xA;&#x9;  ,ca.[customer_filters]&#xA;&#x9;  FROM [webproject].[dbo].[notices_user_events] ev&#xA;&#x9;  OUTER APPLY (SELECT automation.dbo.RowsConcat(f.[customer_filter], ', ') [customer_filters] &#xA;&#x9;  FROM [webproject].[dbo].[notices_user_filters] f&#xA;&#x9;  WHERE f.username = ev.Username AND ev.is_lk_user = 1 AND f.is_lk_user = 1) AS ca&#xA;&#x9;  WHERE COALESCE(customer_filters, '') &lt;&gt; '') AS src&#xA;ON (targ.username = src.[username])  &#x9;&#xA;WHEN MATCHED &#xA;AND &#xA;(src.[terminal_arrival_flag] &lt;&gt; targ.[terminal_arrival_flag]&#xA;OR src.[tcd_reception_flag] &lt;&gt; targ.[tcd_reception_flag]&#xA;OR src.[transit_closure_flag] &lt;&gt; targ.[transit_closure_flag]&#xA;OR src.[dt_submit_flag] &lt;&gt; targ.[dt_submit_flag]&#xA;OR src.[dt_registration_flag] &lt;&gt; targ.[dt_registration_flag]&#xA;OR src.[customs_examination_flag] &lt;&gt; targ.[customs_examination_flag]&#xA;OR src.[ptd_arrival_notice_flag] &lt;&gt; targ.[ptd_arrival_notice_flag]&#xA;OR src.[dt_decision_flag] &lt;&gt; targ.[dt_decision_flag]&#xA;OR src.[terminal_departure_flag] &lt;&gt; targ.[terminal_departure_flag]&#xA;OR src.[customer_filters] &lt;&gt; targ.[customer_filters])&#xA;THEN UPDATE &#xA;SET &#xA;targ.[terminal_arrival_flag] = src.[terminal_arrival_flag],&#xA;targ.[tcd_reception_flag] = src.[tcd_reception_flag],&#xA;targ.[transit_closure_flag] = src.[transit_closure_flag],&#xA;targ.[dt_submit_flag] = src.[dt_submit_flag],&#xA;targ.[dt_registration_flag] = src.[dt_registration_flag],&#xA;targ.[customs_examination_flag] = src.[customs_examination_flag],&#xA;targ.[ptd_arrival_notice_flag] = src.[ptd_arrival_notice_flag],&#xA;targ.[dt_decision_flag] = src.[dt_decision_flag],&#xA;targ.[terminal_departure_flag] = src.[terminal_departure_flag],&#xA;targ.[customer_filters] = src.[customer_filters]&#xA;WHEN NOT MATCHED BY TARGET THEN &#xA;INSERT ([Username]&#xA;      ,[terminal_arrival_flag]&#xA;      ,[tcd_reception_flag]&#xA;      ,[transit_closure_flag]&#xA;      ,[dt_submit_flag]&#xA;      ,[dt_registration_flag]&#xA;      ,[customs_examination_flag]&#xA;      ,[ptd_arrival_notice_flag]&#xA;      ,[dt_decision_flag]&#xA;      ,[terminal_departure_flag]&#xA;      ,[customer_filters])&#xA;VALUES (src.[Username]&#xA;      ,src.[terminal_arrival_flag]&#xA;      ,src.[tcd_reception_flag]&#xA;      ,src.[transit_closure_flag]&#xA;      ,src.[dt_submit_flag]&#xA;      ,src.[dt_registration_flag]&#xA;      ,src.[customs_examination_flag]&#xA;      ,src.[ptd_arrival_notice_flag]&#xA;      ,src.[dt_decision_flag]&#xA;      ,src.[terminal_departure_flag]&#xA;&#x9;  ,src.[customer_filters]);" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\SELECT писем для отправки"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Задача &quot;Выполнение SQL&quot;"
      DTS:DTSID="{bb952960-6f2f-4302-8d48-7867f2d6d6ba}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="SELECT писем для отправки"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2019; © 2019 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{9FEB3277-5F6F-47B9-86DD-F48ABBDA0231}"
          SQLTask:BypassPrepare="False"
          SQLTask:SqlStatementSource="SELECT [Username]&#xA;      ,[subj]&#xA;      ,[msg]      &#xA;      ,[id]&#x9; &#xA;  FROM [webproject].[dbo].[notices_lk_change]  &#xA;  WHERE is_sent = 0"
          SQLTask:ResultType="ResultSetType_Rowset" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding
            SQLTask:ResultName="0"
            SQLTask:DtsVariableName="User::object" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\UPDATE"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{C77251F0-5FFD-47DC-9319-F3F4AF552109}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="UPDATE"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{9FEB3277-5F6F-47B9-86DD-F48ABBDA0231}"
          SQLTask:SqlStatementSource="UPDATE [webproject].[dbo].[notices_lk_change]  &#xA;  SET is_sent = 1&#xA;  WHERE is_sent = 0" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Контейнер &quot;Цикл по каждому элементу&quot; 1"
      DTS:CreationName="STOCK:FOREACHLOOP"
      DTS:Description="Контейнер &quot;Цикл по каждому элементу&quot;"
      DTS:DTSID="{9b188e9d-b21a-4c40-9968-99d2918a9d32}"
      DTS:ExecutableType="STOCK:FOREACHLOOP"
      DTS:LocaleID="-1"
      DTS:ObjectName="Контейнер &quot;Цикл по каждому элементу&quot; 1">
      <DTS:ForEachEnumerator
        DTS:CreationName="Microsoft.ForEachADOEnumerator"
        DTS:DTSID="{c19980a5-a574-4633-84de-2b029ed9565b}"
        DTS:ObjectName="{66F4DB38-AAEE-4B0B-BC6A-6565E3156157}">
        <DTS:ObjectData>
          <FEEADO
            EnumType="EnumerateRowsInFirstTable"
            VarName="User::object" />
        </DTS:ObjectData>
      </DTS:ForEachEnumerator>
      <DTS:Variables>
        <DTS:Variable
          DTS:CreationName=""
          DTS:DTSID="{49a71d7b-b9a5-4a2f-94e0-8528fd7996b7}"
          DTS:IncludeInDebugDump="2345"
          DTS:Namespace="User"
          DTS:ObjectName="LetterText">
          <DTS:VariableValue
            DTS:DataType="8"
            xml:space="preserve"></DTS:VariableValue>
        </DTS:Variable>
      </DTS:Variables>
      <DTS:Executables>
        <DTS:Executable
          DTS:refId="Package\Контейнер &quot;Цикл по каждому элементу&quot; 1\Отправка почтовых уведомлений"
          DTS:CreationName="Microsoft.SendMailTask"
          DTS:DelayValidation="True"
          DTS:DTSID="{b47ac835-e330-4d1e-a1fb-a1179b7030b8}"
          DTS:ExecutableType="Microsoft.SendMailTask"
          DTS:ExecValue="1"
          DTS:ExecValueType="3"
          DTS:LocaleID="-1"
          DTS:ObjectName="Отправка почтовых уведомлений"
          DTS:TaskContact="Send Mail Task; Microsoft Corporation; SQL Server 2019; © 2019 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
          DTS:ThreadHint="1">
          <DTS:Variables />
          <DTS:PropertyExpression
            DTS:Name="Subject">@[User::subject]</DTS:PropertyExpression>
          <DTS:PropertyExpression
            DTS:Name="ToLine">@[User::toline]</DTS:PropertyExpression>
          <DTS:ObjectData>
            <SendMailTask:SendMailTaskData
              SendMailTask:SMTPServer="{C8786A8B-6D2E-4D7A-ABA7-5DD8F4DEAE84}"
              SendMailTask:From="info@eltransplus.ru"
              SendMailTask:BCC="mailing@eltransplus.ru"
              SendMailTask:Subject="Уведомление о подключении рассылки Елтранс+"
              SendMailTask:MessageSourceType="Variable"
              SendMailTask:MessageSource="User::msgtext" xmlns:SendMailTask="www.microsoft.com/sqlserver/dts/tasks/sendmailtask" />
          </DTS:ObjectData>
        </DTS:Executable>
      </DTS:Executables>
      <DTS:ForEachVariableMappings>
        <DTS:ForEachVariableMapping
          DTS:CreationName=""
          DTS:DTSID="{C67D2886-17F8-4550-BA79-F5DCBE732BEC}"
          DTS:ObjectName="{C67D2886-17F8-4550-BA79-F5DCBE732BEC}"
          DTS:ValueIndex="0"
          DTS:VariableName="User::toline" />
        <DTS:ForEachVariableMapping
          DTS:CreationName=""
          DTS:DTSID="{B472D41B-5A6D-4515-AC28-29EECC090F97}"
          DTS:ObjectName="{B472D41B-5A6D-4515-AC28-29EECC090F97}"
          DTS:ValueIndex="1"
          DTS:VariableName="User::subject" />
        <DTS:ForEachVariableMapping
          DTS:CreationName=""
          DTS:DTSID="{D19B3695-8BDE-4751-B8F3-F5B2B2E9C0A8}"
          DTS:ObjectName="{D19B3695-8BDE-4751-B8F3-F5B2B2E9C0A8}"
          DTS:ValueIndex="2"
          DTS:VariableName="User::msgtext" />
        <DTS:ForEachVariableMapping
          DTS:CreationName=""
          DTS:DTSID="{16D420EE-CEC2-408E-9F6D-9574D17DB834}"
          DTS:ObjectName="{16D420EE-CEC2-408E-9F6D-9574D17DB834}"
          DTS:ValueIndex="3"
          DTS:VariableName="User::id" />
      </DTS:ForEachVariableMappings>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Ограничение]"
      DTS:CreationName=""
      DTS:DTSID="{EDD0686E-B27A-4BD1-A134-2FAE480642FB}"
      DTS:From="Package\SELECT писем для отправки"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Ограничение"
      DTS:To="Package\UPDATE" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Ограничение 1]"
      DTS:CreationName=""
      DTS:DTSID="{876F13F8-D66F-4DC9-A0BB-0210859D1EF0}"
      DTS:From="Package\Merge"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Ограничение 1"
      DTS:To="Package\SELECT писем для отправки" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Ограничение 3]"
      DTS:CreationName=""
      DTS:DTSID="{2e682962-9bef-4bce-8262-0fb8166a15f9}"
      DTS:From="Package\SELECT писем для отправки"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Ограничение 3"
      DTS:To="Package\Контейнер &quot;Цикл по каждому элементу&quot; 1" />
  </DTS:PrecedenceConstraints>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--В данном разделе CDATA содержатся сведения о макете пакета. В данном разделе содержатся сведения о координатах (x,y), ширине и высоте.-->
<!--В случае возникновения ошибки при редактировании этого раздела вручную его можно удалить. -->
<!--Пакет можно загрузить обычным образом, но прежние сведения о макете будут утеряны, и конструктор автоматически перераспределит элементы в области конструктора.-->
<Objects
  Version="8">
  <!--Все приведенные ниже узлы будут содержать свойства, не влияющие на поведение среды выполнения.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="8" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="217,42"
          Id="Package\SELECT писем для отправки"
          TopLeft="204,75" />
        <NodeLayout
          Size="118,42"
          Id="Package\UPDATE"
          TopLeft="463.5,79" />
        <NodeLayout
          Size="243,42"
          Id="Package\Контейнер &quot;Цикл по каждому элементу&quot; 1\Отправка почтовых уведомлений"
          TopLeft="5.5,5.5" />
        <ContainerLayout
          HeaderHeight="43"
          IsExpanded="True"
          PanelSize="254,103"
          Size="254,146"
          Id="Package\Контейнер &quot;Цикл по каждому элементу&quot; 1"
          TopLeft="185.5,164" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Ограничение]"
          TopLeft="421,98">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="42.5,0"
              Start="0,0"
              End="35,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="35,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Ограничение 3]"
          TopLeft="312.5,117">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,47"
              Start="0,0"
              End="0,39.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,39.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <NodeLayout
          Size="108,42"
          Id="Package\Merge"
          TopLeft="264,9" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Ограничение 1]"
          TopLeft="315.25,51">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,24"
              Start="0,0"
              End="0,16.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,16.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>